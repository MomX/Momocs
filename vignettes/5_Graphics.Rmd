---
title: "Graphics: single shapes and Coo objects"
author: "Vincent Bonhomme"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{05 - Graphics: single shapes and Coo objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

Morphometrics are, by essence, highly concerned with shape graphics and the multivariate statistics we can turn them into. Here I review the core graphical 
functions. They are all derived from `base`graphics yet they may be turned into a `ggplot2` unified style at some point. They are presented in a "chronological" order, from operation on single shapes, to representation of `Coo` objects that are collections of shapes.

The (various) graphics that illustrate multivariate statistics are treated in the vignette dedicated to Multivariate analyses.

Note that graphics below may have a funny appearance. This is due to the restrictions on the graphics/vignettes sizes. Everything should be ok when code is runned on your machine.

# Shape graphics
### Single shape
`coo.plot` is the basic shape plotters in Momocs, used in many functions/methods. 
There is a bunch of options detailed exhaustively in `?coo.plot`, some are illustrated below.

```{r, fig.show='hold'}
library(Momocs)
data(shapes)
shp <- coo.center(shapes[22])
coo.plot(shp)
title(1)
coo.plot(shp, col = "grey80", border = "grey50", lwd = 2,
         zoom = 1.5, )
title(2)
coo.plot(shp, ylim=c(-130, 150),
         xy.axis = FALSE, first.point = FALSE, centroid=FALSE)
title(3)
coo.plot(coo.sample(shp, 64), lty=2, pch=3, points = TRUE, zoom=1.5, main="4")
```

### Add shape(s)
`coo.draw` is a shortcut for adding a shape to an existing plot. First, we shift to the `wings` dataset. See `?wings` for details and credits.

```{r, fig.show='hold'}
data(wings)
w1 <- wings[1]
w2 <- wings[2]
coo.plot(w1, border = "#FF0000", lwd = 0.5, lty = 3, main="Two mosquito wings")
coo.draw(w2, border="#0000FF", col=.transp("000FF", 0.9), poly=FALSE, pch=20)
```

Note that the red-dotted outlines are not biologically relevant, since we want to display landmark positions, with some of them being within the wings. In other words, this should not be drawn as a polygon. That is what we have done with the second shape, with the blue dots, by passing `poly=FALSE`, for `coo.draw` which simply adds a shape in the existing graphical window.

### Two shapes: differences
If we want to illustrate differences in landmark positions, we can use `coo.lolli` (lollipops/lolliplots), and `coo.arrows`. In the background we add, for the first plot, landmarks that correspond to the mean shape. For the second plot, we add landmarks labels which are the row numbers for the shapes.

```{r, fig.show='hold'}
coo.lolli(w1, w2, main="coo.lolli")
coo.arrows(w1, w2, main="coo.arrows")
ldk.labels(w1)
```
  
### Two shapes: Thin plate splines
We will extract the mean shapes of whisky and beer bottles, from the bottles dataset. We have seen the first two steps before. We add some custom arguments to the `tps.` family but it "works" with only the first two.
```{r, fig.show='hold'}
data(bot)
bot.f <- eFourier(bot, 12)
ms <- mshapes(bot.f, "type") #mshapes 'type'-wise, see bot.f$fac
whisky <- ms$shp$whisky
beer   <- ms$shp$beer 
tps.grid(beer, whisky, grid.size = 30, amp=2)
tps.arr(beer, whisky, amp=2, palette=col.summer2)
tps.iso(beer, whisky, amp=2, palette=col.spring)
```

# `Coo` objects: collection of shapes

Let's work on the main objects of Momocs: `Coo` objects. Whether, we are working with `Out`, `Opn` or `Ldk` we roughly want the same thing: check singles shapes within them or plot them all, as a family picture or on the same window.
```{r}
data(bot)
```

### Quick inspection
`Coo` objects can be directly plot, with the old-friend `plot`. If `id` is not specified, then random shapes are plotted and you will be asked to press `<Enter>` to continue your inspection.
```{r, eval=FALSE}
plot(bot) # random inspection (not shown)
```
```{r}
plot(bot, 9) # let's go for a stout
```

### Panel
You may want to present all your data. That is a job for `panel`. Mind that shapes are templated with `coo.template` and size differences will thus be tempered (if not completely invisible). You can use a combination of `fac` and `reorder` to present graphically your groups.

```{r, fig.show='hold'}
panel(bot)
panel(bot, fac = "type", palette=col.spring, names=TRUE)
```

### Stack
Have a look to this method: it plots all the shapes on the same window. It is obvious that shapes are neither centered nor scaled. Also, the first point of their outlines varies along their left side. This may be important to take into account, depending on the subsequent analyses (*e.g* `eFourier`).
```{r, fig.show='hold'}
stack(bot)
bot <- coo.slidedirection(coo.scale(coo.center(bot)), "W")
stack(bot)
```

### Others `Coo` objects
The functions presented above on `Out` can be applied to `Opn` and `Ldk`.

```{r, fig.show='hold'}
data(olea) # Opn 
class(olea)
panel(olea)
stack(olea)

data(wings) # Ldk
class(wings)
panel(wings)
stack(wings)
```

Note that `Ldk` specific functions will be improved in a further version, to include, among other things, links between landmarks.

# `Coe` objects: morphometric coefficients

Some graphic function also apply on `Coe` objects.

```{r, fig.show='hold'}
bot.f <- eFourier(bot, 12)
hist(bot.f)
boxplot(bot.f)
```

You can also pass `Coo` methods to `Coe` objects. Momocs will thus use the inverse transformation to how well (or bad) morphometric coefficients have capture shape structure. 

```{r, fig.show='hold'}
panel(bot.f)
stack(bot.f)
```

Above, it is obvious that default normalization parameters - which consumes A1, A2,  A3 as seen on the graphs above - of the Elliptical Fourier Transforms are failing since some outlines have the bottleneck on the left and others on the right.

These functions also work on `OpnCoe` and on `LdkCoe`:

```{r, fig.show='hold'}
olea.p <- orthoPolynomials(olea, degree = 5, nb.pts = 50)
hist(olea.p)
boxplot(olea.p)
#todo
#panel(olea.p)
#stack(olea.p)

wings.fg <- fgProcrustes(wings, verbose = FALSE)
#todo
#hist(wings.fg)
#boxplot(wings.fg)
panel(wings.fg)
stack(wings.fg)
```
  