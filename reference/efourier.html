<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Elliptical Fourier transform (and its normalization) — efourier • Momocs</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Elliptical Fourier transform (and its normalization) — efourier"><meta name="description" content="efourier computes Elliptical Fourier Analysis (or Transforms or EFT)
from a matrix (or a list) of (x; y) coordinates. efourier_norm normalizes Fourier coefficients.
Read Details carefully."><meta property="og:description" content="efourier computes Elliptical Fourier Analysis (or Transforms or EFT)
from a matrix (or a list) of (x; y) coordinates. efourier_norm normalizes Fourier coefficients.
Read Details carefully."><meta property="og:image" content="http://momx.github.io/Momocs/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Momocs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MomX/Momocs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-ecosystem" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Ecosystem</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-ecosystem"><li><h6 class="dropdown-header" data-toc-skip>Core Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/MomX/">MomX</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momacs/">Momacs</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momit">Momit</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momocs2/">Momocs2</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momstats">Momstats</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extended Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momoshop/">Momoshop</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momdata/">Momdata</a></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momfarm">Momfarm</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Legacy Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://momx.github.io/Momocs/">Momocs</a></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Elliptical Fourier transform (and its normalization)</h1>
      <small class="dont-index">Source: <a href="https://github.com/MomX/Momocs/blob/master/R/core-out-efourier.R" class="external-link"><code>R/core-out-efourier.R</code></a></small>
      <div class="d-none name"><code>efourier.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>efourier</code> computes Elliptical Fourier Analysis (or Transforms or EFT)
from a matrix (or a list) of (x; y) coordinates. <code>efourier_norm</code> normalizes Fourier coefficients.
Read Details carefully.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">efourier</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">efourier</span><span class="op">(</span><span class="va">x</span>, <span class="va">nb.h</span>, smooth.it <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'Out'</span></span>
<span><span class="fu">efourier</span><span class="op">(</span><span class="va">x</span>, <span class="va">nb.h</span>, smooth.it <span class="op">=</span> <span class="fl">0</span>, norm <span class="op">=</span> <span class="cn">TRUE</span>, start <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'list'</span></span>
<span><span class="fu">efourier</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">efourier_norm</span><span class="op">(</span><span class="va">ef</span>, start <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>list</code> or a <code>matrix</code> of coordinates or a <code>Out</code> object</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>useless here</p></dd>


<dt id="arg-nb-h">nb.h<a class="anchor" aria-label="anchor" href="#arg-nb-h"></a></dt>
<dd><p><code>integer</code>. The number of harmonics to use. If missing, 12 is used on shapes;
99 percent of harmonic power on Out objects, both with messages.</p></dd>


<dt id="arg-smooth-it">smooth.it<a class="anchor" aria-label="anchor" href="#arg-smooth-it"></a></dt>
<dd><p><code>integer</code>. The number of smoothing iterations to
perform.</p></dd>


<dt id="arg-norm">norm<a class="anchor" aria-label="anchor" href="#arg-norm"></a></dt>
<dd><p>whether to normalize the coefficients using efourier_norm</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p><code>logical</code>. For <code>efourier</code> whether to consider the first point as homologous;
for <code>efourier_norm</code> whether to conserve the position of the first
point of the outline.</p></dd>


<dt id="arg-ef">ef<a class="anchor" aria-label="anchor" href="#arg-ef"></a></dt>
<dd><p><code>list</code> with <code>a_n</code>, <code>b_n</code>, <code>c_n</code> and
<code>d_n</code> Fourier coefficients, typically returned by efourier</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>efourier</code>, a list with components: <code>an</code>, <code>bn</code>, <code>cn</code>, <code>dn</code> harmonic coefficients, plus <code>ao</code> and <code>co</code>.
The latter should have been named <code>a0</code> and <code>c0</code> in Claude (2008) but I (intentionnaly) propagated the error.</p>
<p>For <code>efourier_norm</code>, a list with components: <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code>
for harmonic coefficients, plus <code>size</code>, the magnitude of the semi-major axis of the first
fitting ellipse, <code>theta</code> angle, in radians, between the starting and the semi-major axis
of the first fitting ellipse, <code>psi</code> orientation of the first fitting ellipse, <code>ao</code> and <code>do</code>, same as above,
and <code>lnef</code> that is the concatenation of coefficients.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For the maths behind see the paper in JSS.</p>
<p>Normalization of coefficients has long been a matter of trouble,
and not only for newcomers. There are two ways of normalizing outlines: the first,
and by far the most used, is to use a "numerical" alignment, directly on the
matrix of coefficients. The coefficients of the first harmonic are consumed
by this process but harmonics of higher rank are normalized in terms of size
and rotation. This is sometimes referred as using the "first ellipse", as the
harmonics define an ellipse in the plane, and the first one is the mother of all
ellipses, on which all others "roll" along. This approach is really convenient
as it is done easily by most software (if not the only option) and by Momocs too.
It is the default option of <code>efourier</code>.</p>
<p>But here is the pitfall: if your shapes are prone to bad aligments among all
the first ellipses, this will result in poorly (or even not at all) "homologous" coefficients.
The shapes particularly prone to this are either (at least roughly) circular and/or with a strong
bilateral symmetry. You can try to use <code><a href="stack.Coo.html">stack</a></code> on the <code><a href="Coe.html">Coe</a></code> object
returned by <code>efourier</code>. Also, and perhaps more explicitely, morphospace usually show a mirroring symmetry,
typically visible when calculated in some couple of components (usually the first two).</p>
<p>If you see these  upside-down (or 180 degrees rotated) shapes on the morphospace,
you should seriously consider aligning your shapes <strong>before</strong> the efourier step,
and performing the latter with <code>norm = FALSE</code>.</p>
<p>Such a pitfall explains the (quite annoying) message when passing <code>efourier</code> with just the <code>Out</code>.</p>
<p>You have several options to align your shapes, using control points (or landmarks),
by far the most time consuming (and less reproducible) but possibly the best one too
when alignment is too tricky to automate.
You can also try Procrustes alignment (see <code><a href="fgProcrustes.html">fgProcrustes</a></code>) through their calliper
length (see <code><a href="coo_aligncalliper.html">coo_aligncalliper</a></code>), etc. You should also make the first
point homologous either with <code><a href="coo_slide.html">coo_slide</a></code> or <code><a href="coo_slidedirection.html">coo_slidedirection</a></code>
to minimize any subsequent problems.</p>
<p>I will dedicate (some day) a vignette or a paper to this problem.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Directly borrowed for Claude (2008).</p>
<p>Silent message and progress bars (if any) with <code>options("verbose"=FALSE)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Claude, J. (2008) <em>Morphometrics with R</em>, Use R! series,
Springer 316 pp.
Ferson S, Rohlf FJ, Koehn RK. 1985. Measuring shape variation of
two-dimensional outlines. <em>Systematic Biology</em> <b>34</b>: 59-68.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other efourier:
<code><a href="efourier_i.html">efourier_i()</a></code>,
<code><a href="efourier_shape.html">efourier_shape()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># single shape</span></span></span>
<span class="r-in"><span><span class="va">coo</span> <span class="op">&lt;-</span> <span class="va">bot</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coo_plot.html">coo_plot</a></span><span class="op">(</span><span class="va">coo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu">efourier</span><span class="op">(</span><span class="va">coo</span>, <span class="fl">12</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># same but silent</span></span></span>
<span class="r-in"><span><span class="fu">efourier</span><span class="op">(</span><span class="va">coo</span>, <span class="fl">12</span>, norm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $an</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] -143.1142910    5.2925309   22.9922936  -11.3596452  -14.9412217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6]   -5.4200881    5.7177112    0.4509076    0.3107020   -3.1633079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11]    0.2814646    3.4927761</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $bn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] -13.8501141 -21.8994092  11.4235084  13.5870435 -12.6401807   2.5050679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7]   5.1968464  -0.5366171  -1.0431706   1.0823659   2.3427969   0.1022387</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  64.44753053  -3.15375656 -17.96822626   5.76052596   7.17390949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6]  -2.98410094  -1.20013013   1.18299684  -0.36305436  -0.46782525</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11]   0.67134872   0.08954658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] -484.90299209   -1.04774048   42.07408510    3.40654863   -9.19128141</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6]   -2.99359284    0.96722479    2.22582484    0.02026172   -2.26134728</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11]   -0.04679906    0.80569603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ao</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 349.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $co</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1080.921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># inverse EFT</span></span></span>
<span class="r-in"><span><span class="va">efi</span> <span class="op">&lt;-</span> <span class="fu"><a href="efourier_i.html">efourier_i</a></span><span class="op">(</span><span class="va">ef</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coo_draw.html">coo_draw</a></span><span class="op">(</span><span class="va">efi</span>, border<span class="op">=</span><span class="st">'red'</span>, col<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="efourier-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># on Out</span></span></span>
<span class="r-in"><span><span class="va">bot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">efourier</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 'norm=TRUE' is used and this may be troublesome. See ?efourier #Details</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 'nb.h' set to 10 (99% harmonic power)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An OutCoe object [ elliptical Fourier analysis ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - $coe: 5 outlines described, 10 harmonics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   type   fake </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> whisky a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> whisky a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> whisky a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> whisky a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> whisky a    </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vincent Bonhomme, Julien Claude.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

